<div class="container">
  <p id="notice"><%= notice %></p>

  <h1>Books</h1>

  <%= link_to 'New Book', new_book_path, class: 'btn btn-primary' %>

  <br><br>

  <ul class="nav nav-tabs" id="show-books" role="tablist">
    <li class="nav-item">
      <a class="nav-link active" id="all-books-tab" data-toggle="tab" href="#all" role="tab" aria-controls="all" aria-selected="true">All Books</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="featured-tab" data-toggle="tab" href="#featured" role="tab" aria-controls="featured" aria-selected="false">Featured Books</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="categories-tab" data-toggle="tab" href="#categories" role="tab" aria-controls="categories" aria-selected="false">Categories</a>
    </li>
  </ul>

  <div class="tab-content" id="show-books-tab-content">
    <div class="tab-pane fade show pad-10 active" id="all" role="tabpanel" aria-labelledby="all-books-tab">
      <table class="table table-striped table-condensed datatable">
        <thead>
          <tr>
            <th></th>
            <th>Title</th>
            <th>Author last name</th>
            <th>Author first name</th>
            <th>Publish year</th>
            <% if user_signed_in? %>
            <th></th>
            <% end %>
            <th></th>
            <% if current_user.try(:admin?) %>
            <th></th>
            <th></th>
            <% end %>
          </tr>
        </thead>

        <tbody>
          <% @books.each do |book| %>
            <tr>
              <td><%= image_tag book.image_url, size: '30' %></td>
              <td><%= book.title %></td>
              <td><%= book.author_last_name %></td>
              <td><%= book.author_first_name %></td>
              <td><%= book.publish_year %></td>
              <% if user_signed_in? %>
              <td>
                <%= form_for Hold.new, class: 'd-inline' do |f| %>
                  <%= f.hidden_field :user_id, value: current_user.id %>
                  <%= f.hidden_field :book_id, value: book.id %>
                  <%= f.hidden_field :request_date, value: DateTime.now %>
                  <%= f.hidden_field :release_date, value: DateTime.now+7 %>
                  <button class="btn btn-success" type="submit">Place a Hold</button>
                <% end %>
              </td>
              <% end %>
              <td><%= link_to 'Show', book, class: 'btn btn-info' %></td>
              <% if current_user.try(:admin?) %>
              <td><%= link_to 'Edit', edit_book_path(book), class: 'btn btn-warning' %></td>
              <td><%= link_to 'Destroy', book, method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-danger' %></td>
              <% end %>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <div class="tab-pane fade pad-10" id="featured" role="tabpanel" aria-labelledby="featured-tab">Coming Soon!</div>

    <div class="tab-pane fade pad-10" id="categories" role="tabpanel" aria-labelledby="categories-tab">
      <% @categories.each do |category| %>
        <%= form_tag search_query_path, method: 'post', class: 'd-inline' do %>
          <%= hidden_field_tag :type, 'genre' %>
          <button class="btn btn-success" type="submit" name="term" value="<%= category.genre %>"><%= category.genre %></button>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
